<% # Clients of this partial must supply the following variable:
   # agreement
   # user
   #
   # Additionally, they can override the following variables:
   index ||= 0
   notice ||= nil
   url ||= nil
   ref ||= nil
   remote ||= false %>

<% if notice %>
  <p id="notice" class = "fine_print notice"><%= notice %></p>
<% end %>

<% if agreement.display_name %>
  <h1 class="fine_print agreement name">
    <%= agreement.name %>
  </h1>
<% end %>

<% if agreement.display_version %>
  <h3 class="fine_print agreement version">
    Version: <%= agreement.version %>
  </h3>
<% end %>

<% if agreement.display_updated %>
  <h3 class="fine_print agreement updated">
    Last updated: <%= agreement.updated_at %>
  </h3>
<% end %>

<pre class="fine_print agreement content">
  <%= agreement.content %>
</pre>

<% if agreement.can_be_accepted_by?(user) %>
  <%= form_tag fine_print.user_agreements_path, :remote => remote do %>
    <%= hidden_field_tag :agreement_id, agreement.id %>
    <%= hidden_field_tag :index, index %>
    <%= hidden_field_tag :url, url %>
    <%= hidden_field_tag :ref, ref %>
    <% if agreement.display_confirmation %>
      <div class="field">
        <%= label_tag :confirmation_checkbox, agreement.confirmation_text, :class => "fine_print label" %>
        <%= check_box_tag :confirmation_checkbox, 1, false, :id => "fine_print_confirmation_checkbox_#{index}", :class => "fine_print checkbox" %><br/>
      </div>
    <% end %>
    <div class="actions">
      <%= submit_tag (agreement.display_confirmation ? 'OK' : agreement.confirmation_text), :id => "fine_print_submit_ok_#{index}", :class => "fine_print submit" %>
      <%= submit_tag :Cancel, :name => 'cancel', :class => "fine_print submit" %>
    </div>
  <% end %>
  <% if agreement.display_confirmation %>
    <script>
      fine_print_agreement_checkbox(<%= index %>);
    </script>
  <% end %>
<% elsif !agreement.ready %>
  This agreement is not yet ready to be used.<br/>
<% else %>
  Please <%= FinePrint.sign_in_path.nil? ? 'sign in' : link_to('sign in', FinePrint.sign_in_path) %> to accept this agreement.<br/>
<% end %>

